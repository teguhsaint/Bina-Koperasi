<h3>Tambah pinjaman</h3>

<div class="modal fade" id="modalId" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitleId">Pilih pinjaman anda</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modalbd"></div>
    </div>
  </div>
</div>

<div class="mb-3 mt-5">
  <label for="" class="form-label">Kode pj</label>
  <input type="text" disabled name="kode_pj" id="kode_pj" class="form-control" />
</div>
<div class="mb-3">
  <label for="" class="form-label">kode Anggota</label>
  <input type="text" disabled name="kode_Anggota" placeholder="Pilih Anggota" id="agt_kode" class="form-control" autocomplete="off" />
</div>
<div class="mb-3">
  <label for="" class="form-label">nama Anggota</label>
  <input type="text" name="kode_Anggota" placeholder="Pilih Anggota" id="agt_nama" class="form-control" autocomplete="off" />
</div>

<div class="mb-3 mt-5">
  <label for="" class="form-label">Tanggal</label>
  <input type="date" name="tanggal" id="tanggal" class="form-control" />
</div>

<div class="mb-3 mt-5">
  <label for="" class="form-label">Jumlah</label>
  <input type="text" name="jumlah" id="jumlah" class="form-control" data-type="currency" />
</div>
<div class="mb-3 mt-5">
  <label for="" class="form-label">bunga</label>
  <input type="text" name="bunga" id="bunga" class="form-control" data-type="currency" />
</div>
<div class="mb-3 mt-5">
  <label for="" class="form-label">status</label>
  <input type="text" name="status" id="status" class="form-control" data-type="currency" />
</div>
<button id="button">Simpan</button>
<script src="assets/js/duit.js"></script>


<script>
  $('#button').click(function() {
    var kode_pj= $('#kode_pj').val()
    var kode_Anggota = $('#agt_kode').val()
    var tanggal= $('#tanggal').val()
    var jumlah= $('#jumlah').val()
    var bunga= $('#bunga').val()
    var status= $('#status').val()

    $.ajax({
      type: "post",
      url: url_folder_api+'/api/insert_pinjaman.php',
      data: {
        kode_pj:kode_pj,
        kode_Anggota:kode_Anggota,
        tanggal:tanggal,
        jumlah:jumlah,
        bunga:bunga,
        status:status
      },
      dataType: "json",
      success: function (response) {
        console.log(response);
        alert(response)
        $('#kode_pj').val("");
        $('#kode_Anggota').val("");
        $('#tanggal').val("");
        $('#jumlah').val("");
        $('#bunga').val("");
        $('#status').val("");
      }
    });
  })
</script>

<script>
  // Jquery Dependency
  var tgl = new Date();
  $("#tanggal").val(tgl.getFullYear() + "-" + (tgl.getMonth() + 1) + "-" + tgl.getDate());

  $("#modalbd").load("pages/baca_pinjaman.html");

  $("#agt_nama").click(function () {
    $("#modalId").modal("show");
  });

  function ambil_data_pinjaman(element) {
    $("#modalId").modal("hide");
    $('#jumlah').trigger('focus');
    $("#agt_nama").val($(element).attr("data_nama"));
    $("#agt_kode").val($(element).attr("data_id"));
    cek_kode($("#agt_kode").val())
  }
  function cek_kode(kode_Anggota){
      var kode = kode_Anggota.replaceAll('O0','').replaceAll('_','')
      $.ajax({
        type: "POST",
        url: url_folder_api+'api/model.php',
        data: {
            pr:'ambil_pjterakhir',
            agt_kode:kode,
        },
        dataType: "json",
        success: function (response) {
            $('#kode_pj').val(response)
        }
      });
   

  }
  
</script>
